# Deploying Smart Investment Dashboard on AWS

This guide explains how to deploy your unified PERN stack application (React Frontend + Node.js Backend) to AWS.

## Prerequisites
*   **AWS Account**
*   **GitHub Repository** with your project code.
*   **AWS CLI** installed and configured (optional but helpful).

## Method 1: AWS App Runner (Fastest & Easiest)
AWS App Runner is the simplest "Zero Ops" way to deploy a container.

1.  **Go to App Runner** > **Create Service**.
2.  **Source**: "Source Code Repository" > Connect GitHub.
3.  **Deployment Settings**: "Automatic" (deploys on push).
4.  **Build Settings**:
    *   **Runtime**: Nodejs 18
    *   **Build Command**: `npm install && npm run build` (Note: App Runner natively doesn't support multi-stage Dockerfiles perfectly in "Code" mode. **Method 2 is better for this specific project** because we have a complex Dockerfile).
    *   *Correction*: For this unified app, **choose "Container Image"** source in App Runner if you can push to ECR first, OR use Method 2.

---

## Method 2: AWS ECS + CodePipeline (Professional CI/CD)
This is the industry-standard way to deploy containerized apps. It sets up a pipeline: **GitHub -> CodeBuild (Docker Build) -> ECR (Registry) -> ECS (Server)**.

### Phase 1: Create an ECR Repository (Where images live)
1.  Go to **Amazon ECR** > **Create Repository**.
2.  Visibility: **Private**.
3.  Name: `smart-investment-dashboard`.
4.  Click **Create**.
5.  **Copy the URI** (e.g., `123456789012.dkr.ecr.us-east-1.amazonaws.com/smart-investment-dashboard`).

### Phase 2: Create ECS Task Definition (The "Blueprint")
1.  Go to **Amazon ECS** > **Task Definitions** > **Create new specifiction**.
2.  **Launch Type**: AWS Fargate.
3.  **OS Family**: Linux / X86_64.
4.  **Task Role**: `ecsTaskExecutionRole` (creates automatically if needed).
5.  **Container Details**:
    *   **Name**: `smart-investment-container` (Remember this name).
    *   **Image URI**: Paste the ECR URI you copied + `:latest` (e.g. `.../smart-investment-dashboard:latest`).
    *   **Port Mappings**: Container Port `3001`.
6.  **Environment Variables** (Add key-value pairs here):
    *   `DATABASE_URL`: `postgresql://user:pass@ep-xyz.neon.tech/neondb...`
    *   `NODE_ENV`: `production`
7.  Click **Create**.

### Phase 3: Create ECS Cluster & Service (The "Servers")
1.  Go to **Clusters** > **Create Cluster**.
2.  Name: `smart-invest-cluster` > **Infrastructure**: Fargate.
3.  Click **Create**.
4.  Open the Cluster > **Services** Tab > **Create**.
    *   **Compute options**: Launch type (Fargate).
    *   **Task Definition**: Select the one you created in Phase 2.
    *   **Service Name**: `smart-invest-service`.
    *   **Desired tasks**: 1.
    *   **Networking**: Ensure the Security Group allows **Custom TCP Port 3001** and **HTTP 80** from Anywhere (`0.0.0.0/0`).
    *   **Load Balancing**: (Optional but recommended) create an Application Load Balancer to map Port 80 to Container Port 3001. If skipped, you must access via the Public IP of the specific task on port 3001.
5.  Click **Create**.

### Phase 4: Create CodePipeline (The Automation)
This connects your GitHub to the setup above.

1.  Go to **CodePipeline** > **Create Pipeline**.
2.  **Name**: `smart-invest-pipeline`.
3.  **Source Stage**:
    *   Source Provider: **GitHub (Version 2)**.
    *   Connect your account and select the Repo & Branch.
4.  **Build Stage**:
    *   Build Provider: **AWS CodeBuild**.
    *   Click **Create Project**:
        *   **Environment**: Managed Image > Amazon Linux 2 (Standard) > Latest Image.
        *   **Privileged**: **CHECK THIS BOX** (Crucial for building Docker).
        *   **Buildspec**: "Use a buildspec file".
        *   **Environment Variables** (In CodeBuild setup):
            *   `AWS_DEFAULT_REGION`: `us-east-1` (or your region)
            *   `AWS_ACCOUNT_ID`: Your number (find in top right menu).
            *   `IMAGE_REPO_NAME`: `smart-investment-dashboard`
            *   `IMAGE_TAG`: `latest`
5.  **Deploy Stage**:
    *   Deploy Provider: **Amazon ECS**.
    *   Cluster Name: `smart-invest-cluster`.
    *   Service Name: `smart-invest-service`.
    *   **Image Definitions File**: `imagedefinitions.json` (This file is generated by our `buildspec.yml`).
6.  Click **Create Pipeline**.

### Final Verification
*   The pipeline will start running immediately.
*   It will pull from GitHub, use `buildspec.yml` to build the Docker image, push it to ECR, and create `imagedefinitions.json`.
*   Then it triggers ECS to update your Service with the new image.
*   Once "Deploy" turns green, verify your app IP/URL!
